@inject IJSRuntime JSRuntime

@* Components/ImageModal.razor *@

@if (IsVisible)
{
    <div class="blazor-modal-backdrop" @onclick="Close">
        <div class="blazor-modal-dialog" @onclick:stopPropagation>
            <div class="modal-content">
                <!-- Header -->
                <div class="modal-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="modal-title mb-0">
                        <i class="fas fa-car"></i> عکس پلاک خودرو
                    </h5>
                    <button type="button" class="btn-close-white" @onclick="Close" @onclick:stopPropagation>
                        ×
                    </button>
                </div>

                <!-- Body -->
                <div class="modal-body text-center p-0">
                    @if (string.IsNullOrEmpty(ImageUrl))
                    {
                        <div class="p-5 text-muted">
                            <i class="fas fa-image fa-3x"></i>
                            <p class="mt-3">عکسی ثبت نشده است.</p>
                        </div>
                    }
                    else
                    {
                        <img src="@ImageUrl"
                             alt="عکس پلاک"
                             class="img-fluid"
                             style="max-height: 70vh; object-fit: contain;" />
                    }
                </div>

                <!-- Footer -->
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-outline-primary btn-flat" @onclick="Close">
                        <i class="fas fa-times"></i> بستن
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public string? ImageUrl { get; set; }
    [Parameter] public EventCallback OnClose { get; set; }

    private bool IsVisible { get; set; }

    public void Show(string? imageUrl)
    {
        ImageUrl = imageUrl;
        IsVisible = true;
        StateHasChanged();
    }

    private async Task Close()
    {
        IsVisible = false;
        StateHasChanged();
        if (OnClose.HasDelegate)
            await OnClose.InvokeAsync();
    }

    // بستن با ESC
    protected override async Task OnInitializedAsync()
    {
        await JSRuntime.InvokeVoidAsync("blazorModal.setupEsc", DotNetObjectReference.Create(this));
    }

    [JSInvokable]
    public void CloseFromJs() => Close();
}