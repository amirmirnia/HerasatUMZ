@using Application.DTOs.More
@using Client.Services.Alert
@inject AlertService AlertService
@implements IDisposable

@foreach (var alert in alerts)
{
    <Alert Type="@alert.Type"
           Title="@alert.Title"
           OnClose="() => Remove(alert.Id)">
        @alert.Message
    </Alert>
}

@code {
    private List<AlertModel> alerts = new();
    private int idCounter = 0;

    // زمان به ثانیه (اینجا ۵ ثانیه)
    private const int AutoCloseDelay = 5000;

    protected override async Task OnInitializedAsync()
    {
        AlertService.OnShow += OnAlertShow;
    }

    private async void OnAlertShow(string message, string title, AlertType type)
    {
        var alert = new AlertModel
            {
                Id = ++idCounter,
                Message = message,
                Title = title,
                Type = type
            };

        alerts.Add(alert);
        StateHasChanged();

        // خودکار حذف کردن بعد از زمان مشخص شده
        _ = Task.Delay(AutoCloseDelay).ContinueWith(_ =>
        {
            InvokeAsync(() =>
            {
                Remove(alert.Id);
            });
        });
    }

    private void Remove(int id)
    {
        alerts.RemoveAll(a => a.Id == id);
        StateHasChanged();
    }

    public void Dispose()
    {
        AlertService.OnShow -= OnAlertShow;
    }
}